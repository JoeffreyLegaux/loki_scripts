
SUBROUTINE ACDRME_OPENACC (YDCST, YDSTA, YDPHY2, YDTOPH, KIDIA, KFDIA, KLON, KTDIA&
&, KLEV, PCP, PDELP, PT, PQ, PU, PV, PFRMH, PFRMQ, PSTRMU, PSTRMV, YDSTACK)
!$acc routine (ACDRME_OPENACC) seq
USE PARKIND1,ONLY:JPIM, JPRB

USE YOMPHY2,ONLY:TPHY2
USE YOMTOPH,ONLY:TTOPH
USE YOMCST,ONLY:TCST
USE YOMSTA,ONLY:TSTA
USE STACK_MOD
#include "stack.h"

IMPLICIT NONE

TYPE (TCST), INTENT (IN)::YDCST
TYPE (TSTA), INTENT (IN)::YDSTA
TYPE (TPHY2), INTENT (IN)::YDPHY2
TYPE (TTOPH), INTENT (IN)::YDTOPH
INTEGER (KIND=JPIM), INTENT (IN)::KLON
INTEGER (KIND=JPIM), INTENT (IN)::KLEV
INTEGER (KIND=JPIM), INTENT (IN)::KIDIA
INTEGER (KIND=JPIM), INTENT (IN)::KFDIA
INTEGER (KIND=JPIM), INTENT (IN)::KTDIA
REAL (KIND=JPRB), INTENT (IN)::PCP (KLON, KLEV)
REAL (KIND=JPRB), INTENT (IN)::PDELP (KLON, KLEV)
REAL (KIND=JPRB), INTENT (IN)::PT (KLON, KLEV)
REAL (KIND=JPRB), INTENT (IN)::PQ (KLON, KLEV)
REAL (KIND=JPRB), INTENT (IN)::PU (KLON, KLEV)
REAL (KIND=JPRB), INTENT (IN)::PV (KLON, KLEV)
REAL (KIND=JPRB), INTENT (OUT)::PFRMH (KLON, 0:KLEV)
REAL (KIND=JPRB), INTENT (OUT)::PFRMQ (KLON, 0:KLEV)
REAL (KIND=JPRB), INTENT (OUT)::PSTRMU (KLON, 0:KLEV)
REAL (KIND=JPRB), INTENT (OUT)::PSTRMV (KLON, 0:KLEV)
TYPE(STACK) :: YDSTACK
TYPE(STACK) :: YLSTACK

temp (REAL (KIND=JPRB), ZTENQ, (KLON, KLEV))
temp (REAL (KIND=JPRB), ZTENT, (KLON, KLEV))
temp (REAL (KIND=JPRB), ZTENV, (KLON, KLEV))
temp (REAL (KIND=JPRB), ZTENU, (KLON, KLEV))

INTEGER (KIND=JPIM)::JLON
INTEGER (KIND=JPIM)::JLEV

REAL (KIND=JPRB)::ZUNMAL
REAL (KIND=JPRB)::ZRGI
REAL (KIND=JPRB)::ZALPHA


YLSTACK = YDSTACK

alloc (ZTENQ)
alloc (ZTENT)
alloc (ZTENV)
alloc (ZTENU)



JLON = KIDIA


ZRGI=1.0_JPRB/YDCST%RG
ZALPHA=1.0_JPRB
ZUNMAL=1.0_JPRB-ZALPHA

DO JLEV=KTDIA-1, KLEV
  
  PSTRMU (JLON, JLEV)=0.0_JPRB
  PSTRMV (JLON, JLEV)=0.0_JPRB
  PFRMH (JLON, JLEV)=0.0_JPRB
  PFRMQ (JLON, JLEV)=0.0_JPRB
  
ENDDO


DO JLEV=KTDIA, KLEV
  
  ZTENU (JLON, JLEV)=-YDTOPH%RMESOU (JLEV)/(1.0_JPRB+YDTOPH%RMESOU (JLEV&
  &)*ZALPHA*YDPHY2%TSPHY)*(PU (JLON, JLEV)-YDTOPH%RUREL (JLEV))
  ZTENV (JLON, JLEV)=-YDTOPH%RMESOU (JLEV)/(1.0_JPRB+YDTOPH%RMESOU (JLEV&
  &)*ZALPHA*YDPHY2%TSPHY)*(PV (JLON, JLEV)-YDTOPH%RVREL (JLEV))
  ZTENT (JLON, JLEV)=-YDTOPH%RMESOT (JLEV)/(1.0_JPRB+YDTOPH%RMESOT (JLEV&
  &)*ZALPHA*YDPHY2%TSPHY)*(PT (JLON, JLEV)-YDTOPH%RTREL (JLEV))
  ZTENQ (JLON, JLEV)=-YDTOPH%RMESOQ (JLEV)/(1.0_JPRB+YDTOPH%RMESOQ (JLEV&
  &)*ZALPHA*YDPHY2%TSPHY)*(PQ (JLON, JLEV)-YDTOPH%RQREL (JLEV))
  
ENDDO


DO JLEV=KLEV, KTDIA,-1
  
  PSTRMU (JLON, JLEV-1)=PSTRMU (JLON, JLEV)+ZRGI*ZTENU (JLON, JLEV)*PDELP (JLON, JLEV)
  PSTRMV (JLON, JLEV-1)=PSTRMV (JLON, JLEV)+ZRGI*ZTENV (JLON, JLEV)*PDELP (JLON, JLEV)
  PFRMH (JLON, JLEV-1)=PFRMH (JLON, JLEV)+ZRGI*ZTENT (JLON, JLEV)*PDELP (JLON, JLEV)*PCP (JLON, JLEV)
  PFRMQ (JLON, JLEV-1)=PFRMQ (JLON, JLEV)+ZRGI*ZTENQ (JLON, JLEV)*PDELP (JLON, JLEV)
  
ENDDO



ENDSUBROUTINE ACDRME_OPENACC

! 56ad6923076b622f9a4a36289517d0f4b37156a2
