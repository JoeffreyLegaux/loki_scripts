
SUBROUTINE ACDAYD_OPENACC (YDCST, YDRIP, KIDIA, KFDIA, KLON, KLEV&
&, KTDIA, KSGST, PGEMU, PMU0, PAPHIF, PDELP, PFRSO, YDSTACK)
!$acc routine (ACDAYD_OPENACC) seq
USE PARKIND1,ONLY:JPIM, JPRB

USE YOMCST,ONLY:TCST
USE YOMRIP,ONLY:TRIP
USE YOMLSFORC,ONLY:LMUSCLFA, NMUSCLFA
USE STACK_MOD
#include "stack.h"

IMPLICIT NONE

TYPE (TCST), INTENT (IN)::YDCST
TYPE (TRIP), INTENT (IN)::YDRIP
INTEGER (KIND=JPIM), INTENT (IN)::KIDIA
INTEGER (KIND=JPIM), INTENT (IN)::KFDIA
INTEGER (KIND=JPIM), INTENT (IN)::KLON
INTEGER (KIND=JPIM), INTENT (IN)::KLEV
INTEGER (KIND=JPIM), INTENT (IN)::KTDIA
INTEGER (KIND=JPIM), INTENT (IN)::KSGST
REAL (KIND=JPRB), INTENT (IN)::PGEMU (KLON)
REAL (KIND=JPRB), INTENT (IN)::PMU0 (KLON)
REAL (KIND=JPRB), INTENT (IN)::PAPHIF (KLON, KLEV)
REAL (KIND=JPRB), INTENT (IN)::PDELP (KLON, KLEV)
REAL (KIND=JPRB), INTENT (INOUT)::PFRSO (KLON, 0:KLEV, KSGST+1)
TYPE(STACK) :: YDSTACK
TYPE(STACK) :: YLSTACK


INTEGER (KIND=JPIM)::JLEV
INTEGER (KIND=JPIM)::JLON
temp (REAL (KIND=JPRB), ZTEND, (KLON, KLEV))
temp (REAL (KIND=JPRB), ZDAYDUR, (KLON, KLEV))

REAL (KIND=JPRB)::ZPI
REAL (KIND=JPRB)::ZEPSILON
REAL (KIND=JPRB)::ZCOSPHI
REAL (KIND=JPRB)::ZCOSLAT
REAL (KIND=JPRB)::ZSINLAT
REAL (KIND=JPRB)::ZGEOM
REAL (KIND=JPRB)::ZZ
#include "wrscmr.intfb.h"

YLSTACK = YDSTACK

alloc (ZTEND)
alloc (ZDAYDUR)



JLON = KIDIA


ZPI=4._JPRB*ATAN (1._JPRB)
ZDAYDUR (JLON,:)=0._JPRB

DO JLEV=KTDIA, KLEV
  
  ZZ=PAPHIF (JLON, JLEV)/YDCST%RG
  ZGEOM=SQRT (MAX (0._JPRB, 1._JPRB-1._JPRB/(1._JPRB+ZZ/YDCST%RA)**2))
  ZSINLAT=PGEMU (JLON)
  ZCOSLAT=SQRT (MAX (0._JPRB, 1._JPRB-ZSINLAT*ZSINLAT))
  ZCOSPHI=MAX (-0.999_JPRB, MIN (0.999_JPRB,-(ZGEOM+YDRIP%RSIDEC&
  &*ZSINLAT)/YDRIP%RCODEC/MAX (0.0001_JPRB, ZCOSLAT)))
  ZEPSILON=ZPI-ACOS (ZCOSPHI)
  ZDAYDUR (JLON, JLEV)=86400._JPRB*(1._JPRB-ZEPSILON/ZPI)
  
ENDDO



DO JLEV=KTDIA, KLEV
  
  ZTEND (JLON, JLEV)=-YDCST%RG*(PFRSO (JLON, JLEV, 1)-PFRSO (JLON, JLEV-1, 1))/PDELP (JLON, JLEV)
  ZTEND (JLON, JLEV)=ZTEND (JLON, JLEV)*ZDAYDUR (JLON, JLEV)/ZDAYDUR (JLON, KLEV)
  
ENDDO


DO JLEV=KLEV, KTDIA,-1
  
  PFRSO (JLON, JLEV-1, 1)=PFRSO (JLON, JLEV, 1)+PDELP (JLON, JLEV)/YDCST%RG*ZTEND (JLON, JLEV)
  
ENDDO



ENDSUBROUTINE ACDAYD_OPENACC

! 56ad6923076b622f9a4a36289517d0f4b37156a2
