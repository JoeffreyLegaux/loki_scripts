SUBROUTINE GPINISLB_PART1_EXPL (YDGEOMETRY, YGFL, YDDYN, YDDYNA, KST, KEND,   &
& PTE, PUT9, PVT9, PTT9, PSPDT9, PSVDT9, PNHX9, PSPT9, PB2U1, PB2V1, PB2T1, PB2PD1, PB2VD1, PGMVNHX1, &
& PB2SP1, PQICE, PQLI, PQRAIN, PQSNOW, PQGRAUPEL, PL0, PL9, PI0, PI9, PR0, PR9, PS0, PS9, PG0, PG9)

!**** *GPINISLB_PART1_EXPL*

!     Author.
!     -------
!      Philippe Marguinaud *METEO-FRANCE*
!      Original : 28-11-2022

USE PARKIND1, ONLY : JPIM, JPRB
USE YOMHOOK, ONLY : DR_HOOK, LHOOK, JPHOOK

USE GEOMETRY_MOD , ONLY : GEOMETRY
USE YOM_YGFL     , ONLY : TYPE_GFLD
USE YOMDYN       , ONLY : TDYN
USE YOMDYNA      , ONLY : TDYNA


IMPLICIT NONE

TYPE(GEOMETRY)     ,INTENT(IN)             :: YDGEOMETRY
TYPE(TYPE_GFLD)    ,INTENT(IN)             :: YGFL
TYPE(TDYN)         ,INTENT(IN)             :: YDDYN
TYPE(TDYNA)        ,INTENT(IN)             :: YDDYNA
INTEGER(KIND=JPIM) ,INTENT(IN)             :: KST
INTEGER(KIND=JPIM) ,INTENT(IN)             :: KEND
REAL(KIND=JPRB)    ,INTENT(IN)             :: PTE
REAL(KIND=JPRB)    ,INTENT(IN)             :: PUT9(YDGEOMETRY%YRDIM%NPROMA,YDGEOMETRY%YRDIMV%NFLEVG)
REAL(KIND=JPRB)    ,INTENT(IN)             :: PVT9(YDGEOMETRY%YRDIM%NPROMA,YDGEOMETRY%YRDIMV%NFLEVG)
REAL(KIND=JPRB)    ,INTENT(IN)             :: PTT9(YDGEOMETRY%YRDIM%NPROMA,YDGEOMETRY%YRDIMV%NFLEVG)
REAL(KIND=JPRB)    ,INTENT(IN)             :: PSPDT9(YDGEOMETRY%YRDIM%NPROMA,YDGEOMETRY%YRDIMV%NFLEVG)
REAL(KIND=JPRB)    ,INTENT(IN)             :: PSVDT9(YDGEOMETRY%YRDIM%NPROMA,YDGEOMETRY%YRDIMV%NFLEVG)
REAL(KIND=JPRB)    ,INTENT(IN)             :: PNHX9(YDGEOMETRY%YRDIM%NPROMA,YDGEOMETRY%YRDIMV%NFLEVG)
REAL(KIND=JPRB)    ,INTENT(IN)             :: PSPT9(YDGEOMETRY%YRDIM%NPROMA)
REAL(KIND=JPRB)    ,INTENT(OUT)            :: PB2U1(YDGEOMETRY%YRDIM%NPROMA,YDGEOMETRY%YRDIMV%NFLEVG)
REAL(KIND=JPRB)    ,INTENT(OUT)            :: PB2V1(YDGEOMETRY%YRDIM%NPROMA,YDGEOMETRY%YRDIMV%NFLEVG)
REAL(KIND=JPRB)    ,INTENT(OUT)            :: PB2T1(YDGEOMETRY%YRDIM%NPROMA,YDGEOMETRY%YRDIMV%NFLEVG)
REAL(KIND=JPRB)    ,INTENT(OUT)            :: PB2PD1(YDGEOMETRY%YRDIM%NPROMA,YDGEOMETRY%YRDIMV%NFLEVG)
REAL(KIND=JPRB)    ,INTENT(OUT)            :: PB2VD1(YDGEOMETRY%YRDIM%NPROMA,YDGEOMETRY%YRDIMV%NFLEVG)
REAL(KIND=JPRB)    ,INTENT(OUT)            :: PGMVNHX1(YDGEOMETRY%YRDIM%NPROMA,YDGEOMETRY%YRDIMV%NFLEVG)
REAL(KIND=JPRB)    ,INTENT(OUT)            :: PB2SP1(YDGEOMETRY%YRDIM%NPROMA)
REAL(KIND=JPRB)    ,INTENT(OUT)            :: PQICE(YDGEOMETRY%YRDIM%NPROMA,YDGEOMETRY%YRDIMV%NFLEVG)
REAL(KIND=JPRB)    ,INTENT(OUT)            :: PQLI(YDGEOMETRY%YRDIM%NPROMA,YDGEOMETRY%YRDIMV%NFLEVG)
REAL(KIND=JPRB)    ,INTENT(OUT)            :: PQRAIN(YDGEOMETRY%YRDIM%NPROMA,YDGEOMETRY%YRDIMV%NFLEVG)
REAL(KIND=JPRB)    ,INTENT(OUT)            :: PQSNOW(YDGEOMETRY%YRDIM%NPROMA,YDGEOMETRY%YRDIMV%NFLEVG)
REAL(KIND=JPRB)    ,INTENT(OUT)            :: PQGRAUPEL(YDGEOMETRY%YRDIM%NPROMA,YDGEOMETRY%YRDIMV%NFLEVG)
REAL(KIND=JPRB)    ,INTENT(IN)  ,OPTIONAL  :: PL0(YDGEOMETRY%YRDIM%NPROMA,YDGEOMETRY%YRDIMV%NFLEVG)
REAL(KIND=JPRB)    ,INTENT(IN)  ,OPTIONAL  :: PL9(YDGEOMETRY%YRDIM%NPROMA,YDGEOMETRY%YRDIMV%NFLEVG)
REAL(KIND=JPRB)    ,INTENT(IN)  ,OPTIONAL  :: PI0(YDGEOMETRY%YRDIM%NPROMA,YDGEOMETRY%YRDIMV%NFLEVG)
REAL(KIND=JPRB)    ,INTENT(IN)  ,OPTIONAL  :: PI9(YDGEOMETRY%YRDIM%NPROMA,YDGEOMETRY%YRDIMV%NFLEVG)
REAL(KIND=JPRB)    ,INTENT(IN)  ,OPTIONAL  :: PR0(YDGEOMETRY%YRDIM%NPROMA,YDGEOMETRY%YRDIMV%NFLEVG)
REAL(KIND=JPRB)    ,INTENT(IN)  ,OPTIONAL  :: PR9(YDGEOMETRY%YRDIM%NPROMA,YDGEOMETRY%YRDIMV%NFLEVG)
REAL(KIND=JPRB)    ,INTENT(IN)  ,OPTIONAL  :: PS0(YDGEOMETRY%YRDIM%NPROMA,YDGEOMETRY%YRDIMV%NFLEVG)
REAL(KIND=JPRB)    ,INTENT(IN)  ,OPTIONAL  :: PS9(YDGEOMETRY%YRDIM%NPROMA,YDGEOMETRY%YRDIMV%NFLEVG)
REAL(KIND=JPRB)    ,INTENT(IN)  ,OPTIONAL  :: PG0(YDGEOMETRY%YRDIM%NPROMA,YDGEOMETRY%YRDIMV%NFLEVG)
REAL(KIND=JPRB)    ,INTENT(IN)  ,OPTIONAL  :: PG9(YDGEOMETRY%YRDIM%NPROMA,YDGEOMETRY%YRDIMV%NFLEVG)

REAL (KIND=JPHOOK) :: ZHOOK_HANDLE

IF (LHOOK) CALL DR_HOOK('GPINISLB_PART1_EXPL',0,ZHOOK_HANDLE)

!*          1.     PB2[X]1 for prognostic variables.
!                  --------------------------------- 

!*          1.1    PB2[X]1 for GMV variables (U,V,T,NH variables).

IF (YDDYNA%LSLAG) THEN
  PB2U1(KST:KEND,1:YDGEOMETRY%YRDIMV%NFLEVG) = 0.0_JPRB
  PB2V1(KST:KEND,1:YDGEOMETRY%YRDIMV%NFLEVG) = 0.0_JPRB
  PB2T1(KST:KEND,1:YDGEOMETRY%YRDIMV%NFLEVG) = 0.0_JPRB
  IF(YDDYNA%LNHDYN) THEN
    PB2PD1(KST:KEND,1:YDGEOMETRY%YRDIMV%NFLEVG) = 0.0_JPRB
    PB2VD1(KST:KEND,1:YDGEOMETRY%YRDIMV%NFLEVG) = 0.0_JPRB
    IF (YDDYNA%LNHX) PGMVNHX1(KST:KEND,1:YDGEOMETRY%YRDIMV%NFLEVG) = 0.0_JPRB
  ENDIF
ELSE !Eulerian
  IF( YDDYN%NCURRENT_ITER==0 )THEN 
    PB2U1(KST:KEND,1:YDGEOMETRY%YRDIMV%NFLEVG)=PUT9(KST:KEND,1:YDGEOMETRY%YRDIMV%NFLEVG)*PTE
    PB2V1(KST:KEND,1:YDGEOMETRY%YRDIMV%NFLEVG)=PVT9(KST:KEND,1:YDGEOMETRY%YRDIMV%NFLEVG)*PTE
    PB2T1(KST:KEND,1:YDGEOMETRY%YRDIMV%NFLEVG)=PTT9(KST:KEND,1:YDGEOMETRY%YRDIMV%NFLEVG)*PTE
    IF(YDDYNA%LNHDYN) THEN
      PB2PD1(KST:KEND,1:YDGEOMETRY%YRDIMV%NFLEVG)=PSPDT9(KST:KEND,1:YDGEOMETRY%YRDIMV%NFLEVG)*PTE
      PB2VD1(KST:KEND,1:YDGEOMETRY%YRDIMV%NFLEVG)=PSVDT9(KST:KEND,1:YDGEOMETRY%YRDIMV%NFLEVG)*PTE
      IF (YDDYNA%LNHX) PGMVNHX1(KST:KEND,1:YDGEOMETRY%YRDIMV%NFLEVG)=PNHX9(KST:KEND,1:YDGEOMETRY%YRDIMV%NFLEVG)*PTE
    ENDIF
  ELSE
    PB2U1(KST:KEND,1:YDGEOMETRY%YRDIMV%NFLEVG)=0.0_JPRB
    PB2V1(KST:KEND,1:YDGEOMETRY%YRDIMV%NFLEVG)=0.0_JPRB
    PB2T1(KST:KEND,1:YDGEOMETRY%YRDIMV%NFLEVG)=0.0_JPRB
    IF(YDDYNA%LNHDYN) THEN
      PB2PD1(KST:KEND,1:YDGEOMETRY%YRDIMV%NFLEVG)=0.0_JPRB
      PB2VD1(KST:KEND,1:YDGEOMETRY%YRDIMV%NFLEVG)=0.0_JPRB
      IF (YDDYNA%LNHX) PGMVNHX1(KST:KEND,1:YDGEOMETRY%YRDIMV%NFLEVG)=0.0_JPRB
    ENDIF
  ENDIF
ENDIF

!*          1.2    PB2[X]1 for GFL variables, and also PQLI, PQICE.

! input for MF_PHYS and CPG_DIA (useless if NCURRENT_ITER>0).
IF(YGFL%YL%LACTIVE) THEN
  IF (YDDYNA%LSLAG.AND.YDDYNA%LTWOTL) THEN
    PQLI(KST:KEND,1:YDGEOMETRY%YRDIMV%NFLEVG)=PL0(KST:KEND,1:YDGEOMETRY%YRDIMV%NFLEVG)
  ELSE
    PQLI(KST:KEND,1:YDGEOMETRY%YRDIMV%NFLEVG)=PL9(KST:KEND,1:YDGEOMETRY%YRDIMV%NFLEVG)
  ENDIF
ELSE
  PQLI(KST:KEND,1:YDGEOMETRY%YRDIMV%NFLEVG)=0.0_JPRB
ENDIF
IF(YGFL%YI%LACTIVE) THEN
  IF (YDDYNA%LSLAG.AND.YDDYNA%LTWOTL) THEN
    PQICE(KST:KEND,1:YDGEOMETRY%YRDIMV%NFLEVG)=PI0(KST:KEND,1:YDGEOMETRY%YRDIMV%NFLEVG)
  ELSE
    PQICE(KST:KEND,1:YDGEOMETRY%YRDIMV%NFLEVG)=PI9(KST:KEND,1:YDGEOMETRY%YRDIMV%NFLEVG)
  ENDIF
ELSE
  PQICE(KST:KEND,1:YDGEOMETRY%YRDIMV%NFLEVG)=0.0_JPRB
ENDIF
IF(YGFL%YR%LACTIVE) THEN
   IF (YDDYNA%LSLAG.AND.YDDYNA%LTWOTL) THEN
      PQRAIN(KST:KEND,1:YDGEOMETRY%YRDIMV%NFLEVG)=PR0(KST:KEND,1:YDGEOMETRY%YRDIMV%NFLEVG)
   ELSE
      PQRAIN(KST:KEND,1:YDGEOMETRY%YRDIMV%NFLEVG)=PR9(KST:KEND,1:YDGEOMETRY%YRDIMV%NFLEVG)
   ENDIF
ELSE
   PQRAIN(KST:KEND,1:YDGEOMETRY%YRDIMV%NFLEVG)=0.0_JPRB
ENDIF
IF(YGFL%YS%LACTIVE) THEN
   IF (YDDYNA%LSLAG.AND.YDDYNA%LTWOTL) THEN
      PQSNOW(KST:KEND,1:YDGEOMETRY%YRDIMV%NFLEVG)=PS0(KST:KEND,1:YDGEOMETRY%YRDIMV%NFLEVG)
   ELSE
      PQSNOW(KST:KEND,1:YDGEOMETRY%YRDIMV%NFLEVG)=PS9(KST:KEND,1:YDGEOMETRY%YRDIMV%NFLEVG)
   ENDIF
ELSE
   PQSNOW(KST:KEND,1:YDGEOMETRY%YRDIMV%NFLEVG)=0.0_JPRB
ENDIF
IF(YGFL%YG%LACTIVE) THEN
   IF (YDDYNA%LSLAG.AND.YDDYNA%LTWOTL) THEN
      PQGRAUPEL(KST:KEND,1:YDGEOMETRY%YRDIMV%NFLEVG)=PG0(KST:KEND,1:YDGEOMETRY%YRDIMV%NFLEVG)
   ELSE
      PQGRAUPEL(KST:KEND,1:YDGEOMETRY%YRDIMV%NFLEVG)=PG9(KST:KEND,1:YDGEOMETRY%YRDIMV%NFLEVG)
   ENDIF
ELSE
   PQGRAUPEL(KST:KEND,1:YDGEOMETRY%YRDIMV%NFLEVG)=0.0_JPRB
ENDIF


!*          1.3    PB2[X]1 for continuity equation (GMVS).

IF (YDDYNA%LSLAG) THEN
  PB2SP1(KST:KEND)=0.0_JPRB
ELSE
  IF( YDDYN%NCURRENT_ITER == 0 )THEN
    PB2SP1(KST:KEND)=PSPT9(KST:KEND)*PTE
  ELSE
    PB2SP1(KST:KEND)=0.0_JPRB
  ENDIF      
ENDIF

IF (LHOOK) CALL DR_HOOK('GPINISLB_PART1_EXPL',1,ZHOOK_HANDLE)

END SUBROUTINE GPINISLB_PART1_EXPL
